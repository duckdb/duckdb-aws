# name: test/sql/aws_secret_gcs.test
# description: test aws extension with gcs secret
# group: [sql]

require aws

require httpfs

require-env S3_TEST_SERVER_AVAILABLE 1

# Note this test is not very intelligent since we dont assume any profiles to be available
# TODO: remove this test? GCS credentials are now part of the httpfs extension right?

statement ok
SET allow_persistent_secrets=false

statement ok
CREATE SECRET s1 (
    TYPE GCS,
    PROVIDER credential_chain
);

query I
SELECT name FROM which_secret('gcs://haha/hoehoe.parkoe', 'gcs')
----
s1

statement error
from "gcs://a/b.csv"
----

statement ok
CREATE SECRET gcs_secret (
    TYPE gcs,
    PROVIDER credential_chain,
    ENDPOINT "storage.googleapis.com",
    URL_STYLE vhost
);
