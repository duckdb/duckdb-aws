# name: test/sql/aws_sts_secret_profile.test
# description: test getting a secret via a profile that does sts
# group: [sql]

mode skip

require aws

require httpfs

require avro

require parquet

require iceberg

require aws

# statement ok
# CREATE SECRET s3table_secret (
#     TYPE s3,
#     PROVIDER credential_chain,
#     CHAIN 'sts',
#     ASSUME_ROLE_ARN 'arn:aws:iam::840140254803:role/pyiceberg-etl-role'
# );

statement ok
create secret my_sts_secret (
    TYPE s3,
    provider credential_chain,
    chain 'config',
    profile 'sts-profile'
);

statement ok
attach 'arn:aws:s3tables:us-east-2:840140254803:bucket/iceberg-testing' as s3_catalog (
    TYPE ICEBERG,
    ENDPOINT_TYPE 'S3_TABLES'
);

query I
select count(*) from s3_catalog.tpch_sf1.region;
----
5

# statement ok
# CREATE SECRET glue_secret (
#     TYPE S3,
#     PROVIDER credential_chain,
#     CHAIN 'sts',
#     ASSUME_ROLE_ARN 'arn:aws:iam::840140254803:role/pyiceberg-etl-role',
#     REGION 'us-east-2'
# );

#
# statement ok
# select * from 's3://ducklake-test-s3/lineitem.parquet' limit 5;